{% load static %}

<!-- Toast Notification Component -->
<div x-data="toastNotification()" 
     x-show="show" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 transform translate-y-2"
     x-transition:enter-end="opacity-100 transform translate-y-0"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 transform translate-y-0"
     x-transition:leave-end="opacity-0 transform translate-y-2"
     class="position-fixed" 
     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
    <div :class="'alert alert-dismissible fade show ' + getAlertClass()">
        <i :class="getIconClass() + ' me-2'"></i>
        <span x-text="message"></span>
        <button type="button" class="btn-close" @click="hide()"></button>
    </div>
</div>

<!-- Loading Spinner Component -->
<div x-data="loadingSpinner()" 
     x-show="show" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     :class="overlay ? 'loading-overlay' : 'text-center py-4'">
    <div class="spinner-border text-primary" :class="getSizeClass()" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted mt-3" x-text="message"></p>
</div>

<!-- Modal Component -->
<div x-data="modalComponent()" 
     x-show="show" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="modal fade" 
     :class="{'show d-block': show}"
     tabindex="-1" 
     role="dialog"
     :style="show ? 'background-color: rgba(0,0,0,0.5);' : ''">
    <div class="modal-dialog" :class="getSizeClass()" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" x-text="title"></h5>
                <button x-show="closable" 
                        type="button" 
                        class="btn-close" 
                        @click="hideModal()"></button>
            </div>
            <div class="modal-body" x-html="content"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" @click="hideModal()">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Progress Bar Component -->
<div x-data="progressBar()" 
     x-show="show" 
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 transform scale-95"
     x-transition:enter-end="opacity-100 transform scale-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100 transform scale-100"
     x-transition:leave-end="opacity-0 transform scale-95"
     class="card shadow-sm border-0 mb-3">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="fw-bold" x-text="message"></span>
            <span class="text-muted" x-text="Math.round(getProgressPercentage()) + '%'"></span>
        </div>
        <div class="progress" style="height: 20px;">
            <div :class="getProgressClass()" 
                 role="progressbar" 
                 :style="'width: ' + getProgressPercentage() + '%'"
                 :aria-valuenow="progress" 
                 aria-valuemin="0" 
                 :aria-valuemax="max">
            </div>
        </div>
    </div>
</div>

<!-- Data Table Component -->
<div x-data="dataTable()" class="card shadow-sm border-0">
    <!-- Search and Controls -->
    <div class="card-header bg-light">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           placeholder="Search..." 
                           x-model="searchTerm" 
                           @input="search()">
                </div>
            </div>
            <div class="col-md-6 text-end">
                <div class="btn-group">
                    <button class="btn btn-outline-primary btn-sm" @click="clearSelection()">
                        <i class="fas fa-times me-1"></i>Clear Selection
                    </button>
                    <button x-show="selectedItems.length > 0" 
                            class="btn btn-primary btn-sm">
                        <i class="fas fa-check me-1"></i>
                        <span x-text="selectedItems.length"></span> Selected
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Table -->
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th width="50">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       :checked="allSelected"
                                       :indeterminate="someSelected && !allSelected"
                                       @change="allSelected ? clearSelection() : selectAll()">
                            </div>
                        </th>
                        <!-- Table headers will be dynamically inserted here -->
                    </tr>
                </thead>
                <tbody>
                    <template x-for="item in getPaginatedData()" :key="item.id">
                        <tr>
                            <td>
                                <div class="form-check">
                                    <input class="form-check-input" 
                                           type="checkbox" 
                                           :checked="isSelected(item.id)"
                                           @change="selectItem(item.id)">
                                </div>
                            </td>
                            <!-- Table cells will be dynamically inserted here -->
                        </tr>
                    </template>
                    <tr x-show="filteredData.length === 0">
                        <td colspan="100%" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-3x mb-3"></i>
                            <p>No data found</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Pagination -->
    <div x-show="getTotalPages() > 1" class="card-footer">
        <nav>
            <ul class="pagination justify-content-center mb-0">
                <li class="page-item" :class="{'disabled': currentPage === 1}">
                    <button class="page-link" @click="goToPage(currentPage - 1)">Previous</button>
                </li>
                <template x-for="page in Array.from({length: getTotalPages()}, (_, i) => i + 1)" :key="page">
                    <li class="page-item" :class="{'active': page === currentPage}">
                        <button class="page-link" @click="goToPage(page)" x-text="page"></button>
                    </li>
                </template>
                <li class="page-item" :class="{'disabled': currentPage === getTotalPages()}">
                    <button class="page-link" @click="goToPage(currentPage + 1)">Next</button>
                </li>
            </ul>
        </nav>
    </div>
</div>

<!-- File Upload Component -->
<div x-data="fileUpload()" 
     @dragover.prevent="dragOver = true"
     @dragleave.prevent="dragOver = false"
     @drop.prevent="handleFiles($event.dataTransfer.files)"
     class="card shadow-sm border-0">
    <div class="card-body">
        <div class="upload-area text-center py-5" 
             :class="{'drag-over': dragOver}"
             @click="$refs.fileInput.click()">
            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
            <h5>Drop files here or click to browse</h5>
            <p class="text-muted">Maximum {{ maxFiles }} files, {{ formatFileSize(maxSize) }} each</p>
            <input type="file" 
                   x-ref="fileInput" 
                   @change="handleFiles($event.target.files)"
                   multiple 
                   style="display: none;">
        </div>
        
        <!-- File List -->
        <div x-show="files.length > 0" class="mt-4">
            <h6>Selected Files:</h6>
            <div class="list-group">
                <template x-for="fileData in files" :key="fileData.id">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-file me-2"></i>
                            <span x-text="fileData.name"></span>
                            <small class="text-muted ms-2" x-text="formatFileSize(fileData.size)"></small>
                        </div>
                        <div class="d-flex align-items-center">
                            <div x-show="fileData.status === 'uploading'" class="progress me-2" style="width: 100px; height: 20px;">
                                <div class="progress-bar" 
                                     :style="'width: ' + fileData.progress + '%'"></div>
                            </div>
                            <span class="badge me-2" 
                                  :class="{
                                      'bg-warning': fileData.status === 'pending',
                                      'bg-info': fileData.status === 'uploading',
                                      'bg-success': fileData.status === 'completed',
                                      'bg-danger': fileData.status === 'error'
                                  }"
                                  x-text="fileData.status"></span>
                            <button class="btn btn-sm btn-outline-danger" 
                                    @click="removeFile(fileData.id)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" 
                        @click="uploadFiles()" 
                        :disabled="uploading || files.length === 0">
                    <span x-show="!uploading">Upload Files</span>
                    <span x-show="uploading">Uploading...</span>
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-area:hover,
.upload-area.drag-over {
    border-color: #007bff;
    background-color: rgba(0, 123, 255, 0.1);
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    flex-direction: column;
    gap: 20px;
}

.modal.show {
    display: block !important;
}

.progress-bar-animated {
    animation: progress-bar-stripes 1s linear infinite;
}

@keyframes progress-bar-stripes {
    0% { background-position: 1rem 0; }
    100% { background-position: 0 0; }
}
</style>
